<!doctype html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Visuals</title>
    <script src="https://cdn.zingchart.com/zingchart.min.js"></script>
</head>

<body>
    <!-- ZingChart -->
    <div id="charts">
        <div id="bar3"></div>
        <div id="bar2"></div>
        <div id="pie"></div>
    </div>
    <script>
        async function getData(resource, colNames) {
            let url = "/api.php";

            if (resource == "static") {
                url += "/static";
            }
            else if (resource == "performance") {
                url += "/performance";
            }
            else if (resource == "activity") {
                url += "/activity";
            }
            else {
                // send an error message
            }

            // path will be /api.php/{resource}/{col_1}&{col_2}&...&{col_n}
            if (colNames.length != 0) {
                url += "/";
                let lastIndex = colNames.length - 1;
                for (let i = 0; i < lastIndex; i++) {
                    url += colNames[i] + "&"; // & purely for purposes of debugging, php api would work fine without it
                    // since we are using strpos and no colName is a subset of another colName
                }
                url += colNames[lastIndex];
            }

            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`Response status: ${response.status}`);
                }

                const result = await response.json();
                console.log(result);
                return result;
            } catch (error) {
                console.error(error.message);
            }
        }

        ZC.LICENSE = ["569d52cefae586f634c54f86dc99e6a9", "b55b025e438fa8a98e32482b5f768ff5"];

        try {
            const rawData = await getData('static', ['userScreenWidth']); // <== dynamic fetch
            console.log("Fetched data:", rawData);

            // Aggregate counts
            const counts = {};
            rawData.forEach(item => {
                const w = item.userScreenWidth;
                counts[w] = (counts[w] || 0) + 1;
            });

            // Convert to arrays
            const labels = Object.keys(counts);
            const values = Object.values(counts);

            // --- 3-Series Bar Chart ---
            const bar3Config = {
                type: 'bar',
                title: { text: '3-Series Bar Chart Example' },
                scaleX: { labels },
                series: [
                    { values },                                // actual counts
                    { values: values.map(v => v * 2) },        // example transformation
                    { values: values.map(v => v + 1) }         // example transformation
                ]
            };

            // --- 2-Series Bar Chart ---
            const bar2Config = {
                type: 'bar',
                title: { text: '2-Series Bar Chart Example' },
                scaleX: { labels },
                series: [
                    { values },
                    { values: values.map(v => v * 1.5) }
                ]
            };

            // --- Pie Chart ---
            const pieConfig = {
                type: 'pie',
                title: { text: 'Screen Width Distribution' },
                series: labels.map((label, i) => ({
                    text: label,
                    values: [values[i]]
                }))
            };

            // Render
            zingchart.render({ id: 'bar3', data: bar3Config, height: 400, width: '100%' });
            zingchart.render({ id: 'bar2', data: bar2Config, height: 400, width: '100%' });
            zingchart.render({ id: 'pie', data: pieConfig, height: 400, width: '100%' });

        } catch (err) {
            console.error("Error rendering charts:", err);
        }

    </script>
</body>

</html>